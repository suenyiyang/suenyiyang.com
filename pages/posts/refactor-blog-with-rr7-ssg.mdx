---
date: 2025-11-30
lang: zh
---

# ä½¿ç”¨ React Router v7 é‡æ„åšå®¢

æœ€è¿‘æˆ‘ä½¿ç”¨ React Router v7 é‡æ„äº†åŸæœ¬ä½¿ç”¨ Next.js æ­å»ºçš„ä¸ªäººåšå®¢ã€‚è¿™ç¯‡æ–‡ç« è®°å½•äº†é‡æ„çš„åŠ¨æœºã€æŠ€æœ¯é€‰å‹å’Œå®ç°ç»†èŠ‚ã€‚

## 1. ä¸ºä»€ä¹ˆè¦é‡æ„ï¼Ÿ

Next.js æ˜¯ä¸€ä¸ªä¼˜ç§€çš„å…¨æ ˆæ¡†æ¶ï¼Œåœ¨ React åŸºç¡€ä¸Šé¢„ç½®äº† SSRï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰å’Œ RSCï¼ˆReact Server Componentsï¼‰ç­‰èƒ½åŠ›ã€‚

ç„¶è€Œï¼Œå¯¹äºä¸€ä¸ªç®€å•çš„é™æ€åšå®¢æ¥è¯´ï¼Œè¿™äº›èƒ½åŠ›åè€Œå¸¦æ¥äº†ä¸å¿…è¦çš„å¿ƒæ™ºè´Ÿæ‹…ï¼š

- **å¤æ‚çš„çº¦å®š**ï¼šéœ€è¦ç†è§£ Next.js çš„æ–‡ä»¶è·¯ç”±çº¦å®šã€ç‰¹æ®Šç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œè¿˜è¦æ—¶åˆ»è€ƒè™‘ä»£ç ç©¶ç«Ÿåœ¨ Server ç«¯è¿˜æ˜¯ Client ç«¯æ‰§è¡Œã€‚
- **æŒ‡ä»¤é™åˆ¶**ï¼š`"use server"` å’Œ `"use client"` æ–‡ä»¶åœ¨ Hook ä½¿ç”¨ä¸Šæœ‰ä¸åŒçš„é™åˆ¶ã€‚
- **ç»„ä»¶ä¾èµ–è§„åˆ™**ï¼šServer Components å¯ä»¥ä¾èµ– Client Componentsï¼Œä½†åè¿‡æ¥ä¸è¡Œã€‚

è¿™äº›çº¦å®šå¯¹äºå¤§å‹å›¢é˜Ÿé¡¹ç›®æ¥è¯´ï¼Œæœ‰åŠ©äºç»Ÿä¸€æ¶æ„é£æ ¼ï¼›ä½†å¯¹äºä¸ªäººåšå®¢ï¼Œåªä¼šå¢åŠ ä¸å¿…è¦çš„å¤æ‚åº¦ã€‚

äºæ˜¯ï¼Œæˆ‘å†³å®šæ¢ä¸€ä¸ªæ›´è½»é‡çš„æ–¹æ¡ˆã€‚

## 2. ä¸ºä»€ä¹ˆé€‰æ‹© React Router v7ï¼Ÿ

### 2.1. æŠ€æœ¯å°é²œ

React Router v7 (RR7) å‘å¸ƒåä¸ä¹…ï¼Œæˆ‘å°±æƒ³ä½“éªŒä¸€ä¸‹ã€‚ä½œä¸ºä¸ªäººé¡¹ç›®ï¼Œç¨³å®šæ€§ä¸æ˜¯é¦–è¦è€ƒè™‘â€”â€”**å¥½ç©**æ‰æ˜¯ã€‚

### 2.2. åŸç”Ÿ SSG æ”¯æŒ

RR7 å†…ç½®æ”¯æŒ SSGï¼ˆé™æ€ç«™ç‚¹ç”Ÿæˆï¼‰ã€‚é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€åœ¨ `react-router.config.ts` ä¸­è®¾ç½®ï¼š

```ts
export default {
  prerender: true,  // å¼€å¯é¢„æ¸²æŸ“
  ssr: false,       // ç¦ç”¨ SSRï¼Œä½¿ç”¨çº¯é™æ€
  appDirectory: "src",
} satisfies Config;
```

æ„å»ºæ—¶ç”Ÿæˆçš„é™æ€é¡µé¢å’Œèµ„æºï¼Œå¯ä»¥ç›´æ¥æ‰˜ç®¡åˆ° Vercelã€Cloudflare Pages ç­‰å¹³å°ï¼Œæ— éœ€è‡ªå·±ç»´æŠ¤æœåŠ¡å™¨ã€‚

## 3. åšå®¢æ ¸å¿ƒåŠŸèƒ½

### 3.1. è‡ªå®šä¹‰åµŒå¥—æ–‡ä»¶è·¯ç”±

ä½¿ç”¨ SSG çš„åšå®¢é€šå¸¸é‡‡ç”¨ã€Œæ–‡ä»¶è·¯ç”±ã€ï¼ˆFile Based Routeï¼‰â€”â€”é€šè¿‡ç›®å½•ç»“æ„ç»„ç»‡ Markdown æ–‡ä»¶ï¼Œè¿è¡Œæ—¶æŒ‰ç›¸åŒå±‚çº§è®¿é—®é¡µé¢ã€‚

React Router é€šè¿‡ `@react-router/fs-routes` æä¾›äº†æ–‡ä»¶è·¯ç”±æ”¯æŒï¼Œä½†å®ƒå¯¹åµŒå¥—è·¯ç”±çš„å¤„ç†æ–¹å¼ä¸å¤ªç†æƒ³ã€‚ä¾‹å¦‚ï¼š
- `posts/index.mdx` â†’ `/posts`
- `posts/hello-world.mdx` â†’ `/posts/hello-world`

å®˜æ–¹æ–¹æ¡ˆè¦æ±‚å°†æ–‡ä»¶æ”¾åœ¨åŒä¸€çº§ç›®å½•ï¼Œä½¿ç”¨ `.` åˆ†éš”å±‚çº§ï¼š
- `posts._index.mdx` â†’ `/posts`
- `posts.hello-world.mdx` â†’ `/posts/hello-world`

è¿™ç§æ‰å¹³ç»“æ„ä¸ä¾¿äºç®¡ç†ï¼Œä¹Ÿä¸å¤Ÿç›´è§‚ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šReact Router æ”¯æŒè‡ªå®šä¹‰ `RouteConfig`ã€‚æˆ‘åœ¨ `routes.ts` ä¸­ç¼–å†™äº†ä¸€ä¸ªé€’å½’æ‰«æå‡½æ•°ï¼Œæ„å»ºæ—¶è¯»å– `pages` ç›®å½•ç»“æ„ï¼Œè‡ªåŠ¨ç”Ÿæˆç¬¦åˆè¦æ±‚çš„è·¯ç”±é…ç½®ï¼š

```ts
const scanDirectory = (dir: string, basePath: string = "") => {
  const items = readdirSync(dir, { withFileTypes: true });

  for (const item of items) {
    const fullPath = path.join(dir, item.name);

    if (item.isDirectory()) {
      // é€’å½’æ‰«æå­ç›®å½•
      scanDirectory(fullPath, path.join(basePath, item.name));
    } else if (item.isFile()) {
      const ext = path.extname(item.name);
      if (fileExtensions.includes(ext)) {
        const fileName = path.basename(item.name, ext);
        // æ„å»ºè·¯ç”±è·¯å¾„
        let routePath = fileName === "index"
          ? `/${basePath}`
          : `/${basePath}/${fileName}`;
        routes.push(route(routePath, fullPath));
      }
    }
  }
};
```

è¿™æ ·å°±å®ç°äº†çœŸæ­£çš„åµŒå¥—æ–‡ä»¶è·¯ç”±ï¼Œç›®å½•ç»“æ„ä¸ URL è·¯å¾„ä¸€ä¸€å¯¹åº”ã€‚

### 3.2. é¡¹ç›®æ¶æ„

é™æ€ç½‘ç«™é€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š**å†…å®¹**ï¼ˆMarkdown æ–‡ä»¶ï¼‰å’Œ**ç”Ÿæˆå™¨**ï¼ˆè§£æã€æ¸²æŸ“é€»è¾‘ï¼‰ã€‚

æˆ‘çš„åšå®¢ä¹Ÿéµå¾ªè¿™ä¸ªåˆ†ç¦»åŸåˆ™ï¼š

```
â”œâ”€â”€ pages/           # å†…å®¹å±‚ï¼šMarkdown/MDX æ–‡ä»¶
â”‚   â”œâ”€â”€ index.mdx    # é¦–é¡µ
â”‚   â””â”€â”€ posts/       # æ–‡ç« ç›®å½•
â”‚       â”œâ”€â”€ index.mdx
â”‚       â””â”€â”€ hello-world.mdx
â””â”€â”€ src/             # ç”Ÿæˆå±‚ï¼šReact ç»„ä»¶å’Œä¸šåŠ¡é€»è¾‘
    â”œâ”€â”€ components/
    â”œâ”€â”€ logic/
    â””â”€â”€ routes.ts
```

`pages` æ–‡ä»¶å¤¹ç›¸å½“äºåšå®¢çš„ã€Œæ•°æ®åº“ã€ã€‚è¿™ç§æŒ‰å˜æ›´é¢‘ç‡æ‹†åˆ†çš„æ–¹å¼ï¼Œæœ‰åˆ©äºé¡¹ç›®çš„ç¨³å®šè¿­ä»£â€”â€”å†™æ–°æ–‡ç« åªéœ€åœ¨ `pages` ç›®å½•ä¸‹æ·»åŠ  MDX æ–‡ä»¶ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç ã€‚

### 3.3. Content Collections ç®¡ç†æ–‡ç« å…ƒæ•°æ®

ä½¿ç”¨ `@content-collections/core` æ¥ç®¡ç†æ–‡ç« çš„ Frontmatter å…ƒæ•°æ®ã€‚è¿™ä¸ªåº“å¯ä»¥ï¼š
- è‡ªåŠ¨è§£æ MDX æ–‡ä»¶çš„ frontmatter
- æä¾›ç±»å‹å®‰å…¨çš„æ•°æ®è®¿é—®
- åœ¨æ„å»ºæ—¶ç”Ÿæˆæ–‡ç« åˆ—è¡¨

é…ç½®ç¤ºä¾‹ï¼š

```ts
const posts = defineCollection({
  name: "posts",
  directory: "pages/posts",
  include: "**/*.mdx",
  schema,  // Zod schema å®šä¹‰ frontmatter ç»“æ„
  transform: (data, context) => ({
    ...data,
    // è‡ªåŠ¨ä» # æ ‡é¢˜æå– title
    title: data.title ?? getTitleFromContent(data.content),
    _meta: {
      ...data._meta,
      path: getPathnameFromContext(context.collection.directory, data._meta.path),
    },
  }),
});
```

è¿™æ ·ï¼Œåœ¨ç»„ä»¶ä¸­å°±å¯ä»¥ç›´æ¥å¯¼å…¥ç±»å‹å®‰å…¨çš„æ–‡ç« åˆ—è¡¨ï¼š

```tsx
import { allPosts } from "content-collections/generated";
```

### 3.4. è‡ªå®šä¹‰ MDX ç»„ä»¶

é€šè¿‡ `MDXProvider` å¯ä»¥ä¸º MDX å†…å®¹æ³¨å…¥è‡ªå®šä¹‰ç»„ä»¶ã€‚ä¾‹å¦‚ï¼š
- `PostList`ï¼šæ¸²æŸ“æ–‡ç« åˆ—è¡¨
- `PostWrapper`ï¼šä¸ºæ¯ç¯‡æ–‡ç« æ·»åŠ  SEO å…ƒæ•°æ®
- è‡ªå®šä¹‰ `<a>` æ ‡ç­¾ï¼šç»Ÿä¸€å¤„ç†å¤–é“¾

```tsx
export default {
  PostList,
  wrapper: (props) => <PostWrapper {...props} />,
  a: Anchor,
} satisfies MDXComponents;
```

### 3.5. View Transition ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»

ä¸ºäº†è®©æ·±è‰²/æµ…è‰²æ¨¡å¼åˆ‡æ¢æ›´åŠ ä¼˜é›…ï¼Œæˆ‘ä½¿ç”¨äº† View Transition API å®ç°äº†ä¸€ä¸ªåœ†å½¢æ‰©æ•£çš„è¿‡æ¸¡åŠ¨ç”»ã€‚

æ ¸å¿ƒå®ç°æ€è·¯ï¼š

1. ç‚¹å‡»åˆ‡æ¢æŒ‰é’®æ—¶ï¼Œè®°å½•ç‚¹å‡»åæ ‡
2. ä½¿ç”¨ `document.startViewTransition()` å¯åŠ¨è¿‡æ¸¡
3. é€šè¿‡ CSS `clip-path` å®ç°åœ†å½¢æ‰©æ•£æ•ˆæœ

```ts
const x = trigger?.clientX ?? window.innerWidth / 2;
const y = trigger?.clientY ?? window.innerHeight / 2;
const endRadius = Math.hypot(
  Math.max(x, window.innerWidth - x),
  Math.max(y, window.innerHeight - y)
);

document.startViewTransition(() => {
  document.documentElement.classList.toggle("dark", nextIsDark);
});
```

CSS åŠ¨ç”»éƒ¨åˆ†ï¼š

```css
:root[data-theme-transition="to-dark"]::view-transition-old(theme) {
  clip-path: circle(var(--vt-radius) at var(--vt-x) var(--vt-y));
  animation: theme-wipe-out 420ms ease-in forwards;
}

@keyframes theme-wipe-out {
  to {
    clip-path: circle(0 at var(--vt-x) var(--vt-y));
  }
}
```

åŠ¨ç”»ä¼šä»ç‚¹å‡»ä½ç½®å¼€å§‹ï¼Œä»¥åœ†å½¢æ‰©æ•£è‡³å…¨å±ï¼Œè§†è§‰æ•ˆæœéå¸¸æµç•…ã€‚

## 4. éƒ¨ç½²

åšå®¢é€šè¿‡ Vite è¿›è¡Œæ„å»ºï¼Œæœ€ç»ˆç”Ÿæˆçº¯é™æ€æ–‡ä»¶ã€‚éƒ¨ç½²ç­–ç•¥å¦‚ä¸‹ï¼š

1. **é™æ€èµ„æº**ï¼šä¸Šä¼ è‡³é˜¿é‡Œäº‘ OSSï¼Œé€šè¿‡ CDN åŠ é€Ÿ
2. **HTML é¡µé¢**ï¼šéƒ¨ç½²åˆ°è‡ªæœ‰æœåŠ¡å™¨ï¼Œé…ç½® Nginx åå‘ä»£ç†

æ„å»ºå‘½ä»¤ï¼š

```bash
pnpm build  # ç”Ÿæˆé™æ€æ–‡ä»¶
# postbuild è„šæœ¬è‡ªåŠ¨ä¸Šä¼ èµ„æºåˆ° OSS
```

## 5. æ€»ç»“

è¿™æ¬¡é‡æ„è®©æˆ‘çš„åšå®¢å˜å¾—æ›´åŠ è½»é‡ã€çµæ´»ã€‚ä¸»è¦æ”¶è·ï¼š

- **æ›´è½»çš„å¿ƒæ™ºè´Ÿæ‹…**ï¼šä¸å†éœ€è¦è€ƒè™‘ Server/Client è¾¹ç•Œ
- **æ›´çµæ´»çš„æ¶æ„**ï¼šè‡ªå®šä¹‰è·¯ç”±ã€è‡ªå®šä¹‰ç»„ä»¶ï¼Œä¸€åˆ‡å°½åœ¨æŒæ§
- **æ›´å¥½çš„å¼€å‘ä½“éªŒ**ï¼šVite çš„ HMR é€Ÿåº¦å¾ˆå¿«ï¼Œå†™ä½œä½“éªŒæµç•…
- **æœ‰è¶£çš„æŠ€æœ¯æ¢ç´¢**ï¼šView Transition API ç­‰æ–°ç‰¹æ€§çš„å®è·µ

å¦‚æœä½ ä¹Ÿåœ¨è€ƒè™‘æ­å»ºä¸ªäººåšå®¢ï¼ŒReact Router v7 + MDX + Content Collections æ˜¯ä¸€ä¸ªå€¼å¾—å°è¯•çš„æŠ€æœ¯æ ˆç»„åˆã€‚

> ğŸ’¡ æœ¬åšå®¢æºç å¼€æºåœ¨ GitHub: [suenyiyang/suenyiyang.com](https://github.com/suenyiyang/suenyiyang.com)
